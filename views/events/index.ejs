<%- include("../partials/header") %>

  <div class="container my-3" align="right">
    <a class="btn btn-danger" href="/events/new">Add event</a>
    <div id='calendar' class="mt-3"></div>
  </div>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@4.3.1/main.js"></script>
  <script src="https://unpkg.com/@fullcalendar/list@4.3.0/main.min.js"></script>

  <script src='http://fullcalendar.io/js/fullcalendar-2.1.1/lib/moment.min.js'></script>
  <script src='http://fullcalendar.io/js/fullcalendar-2.1.1/lib/jquery.min.js'></script>
  <script src="http://fullcalendar.io/js/fullcalendar-2.1.1/lib/jquery-ui.custom.min.js"></script>
  <script src='http://fullcalendar.io/js/fullcalendar-2.1.1/fullcalendar.min.js'></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var calendarEl = document.getElementById('calendar');

      var calendar = new FullCalendar.Calendar(calendarEl, {
        plugins: [ 'list' ],
        timeZone: 'local',
        defaultView: 'listWeek',

        // customize the button names,
        // otherwise they'd all just say "list"
        views: {
            listDay:   { buttonText: 'list day' },
            listWeek:  { buttonText: 'list week' },
            listMonth: { buttonText: 'list month' }
        },

        header: {
            left: 'title',
            center: '',
            right: 'listDay,listWeek,listMonth'
        },

        events: []
      });

      var list = <%- events %>;
      list.forEach(function(event) {

        // var sDate = new Date(event.startDate).toLocaleDateString().split("/");
        // var sTime = new Date(event.startDate).toLocaleTimeString('en-GB').split(":");
        // var sObj = new Date(sDate[2], sDate[0] - 1, sDate[1], sTime[0], sTime[1], sTime[2]);
        // console.log(sObj);
        // var eDate = new Date(event.endDate).toLocaleDateString().split("/");
        // var eTime = new Date(event.endDate).toLocaleTimeString('en-GB').split(":");
        // var eObj = new Date(eDate[2], eDate[0] - 1, eDate[1], eTime[0], eTime[1], eTime[2]);
        // console.log(eObj);
        var newEvent = {
          id: event._id,
          title: event.name,
          url: "/events/" + event._id,
          start: event.startDate,
          end: event.endDate
        };
        calendar.addEvent(newEvent);
      });

      calendar.render();
    });
  </script>
</body>
</html>
